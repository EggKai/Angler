import hashlib
import requests
import warnings
URL = "https://mb-api.abuse.ch/api/v1/"
def calculate_md5(file_path:str) -> str:
    """Calculate the MD5 hash of a file."""
    hash_md5 = hashlib.md5()
    with open(file_path, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()

def check_malwarebazaar(md5_hash, url:str=URL):
    """Check if the MD5 hash is recognized as malware by MalwareBazaar."""
    data = {
        "query": "get_info",
        "hash": md5_hash        
    }
    headers = { #Auth-key not needed; only for rate limiting purposes
        "Auth-Key": None 
    }
    response = requests.post(url, data=data, headers=headers)
    if response.status_code == 200:
        result = response.json()
        return not result.get("query_status") == "hash_not_found"
    else:
        warnings.warn("Failed to query MalwareBazaar API.")



if __name__ == "__main__":
    md5_hash = calculate_md5("E:/Ollama/exclusions/virus.txt")
    print(f"MD5 Hash: {md5_hash}")
    
    result = check_malwarebazaar(md5_hash)
    print(result)