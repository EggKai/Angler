import pandas as pd
import glob

def process_csv_files(output_file="legit.csv"):
    # 1. Read multiple CSV files matching pattern
    all_files = glob.glob("exe_*.csv")
    
    # 2. Combine into a single DataFrame
    df_list = []
    for file in all_files:
        temp_df = pd.read_csv(file, dtype=str)  # or specify columns if needed
        df_list.append(temp_df)
    combined_df = pd.concat(df_list, ignore_index=True)
    
    # 3. Deduplicate on Imports
    deduped_df = combined_df.drop_duplicates(subset=["Imports","SHA256"])
    
    # 4. Drop Date and FileName columns
    columns_to_drop = ["FilePath"]
    # Only drop if these columns actually exist in the data
    for col in columns_to_drop:
        if col in deduped_df.columns:
            deduped_df.drop(col, axis=1, inplace=True)
    
    # 5. Create 'malware' column with value 1
    deduped_df["malware"] = 0
    
    # 6. Write final DataFrame to a new CSV (no DataFrame printout here)
    deduped_df.to_csv(output_file, index=False)

if __name__ == "__main__":
    process_csv_files("testdata.csv")
