import pandas as pd
from collections import Counter
import re

def list_top_100_imports_no_dll_prefix(csv_file):
    df = pd.read_csv(csv_file, dtype=str)

    all_imports = []

    # Iterate through each row of the "Imports" column
    for imports_str in df["Imports"].dropna():
        # Split by the pipe delimiter
        imports_list = imports_str.split("|")
        
        for imp in imports_list:
            imp = imp.strip()
            if not imp:
                continue
            
            # Split on the first colon
            module_part, sep, func_part = imp.partition(":")

            # Convert module_part to lowercase for case-insensitive check
            module_part_lower = module_part.lower()

            # Check if module_part ends with ".dll"
            if module_part_lower.endswith(".dll"):
                # If there's a function name (func_part) after the colon, keep it
                # Otherwise, skip
                cleaned = func_part.strip()
                if cleaned:
                    all_imports.append(cleaned)
            else:
                # If the module part doesn't end with ".dll", keep the entire original string
                # (Or modify this logic if you prefer to drop these as well.)
                all_imports.append(imp)

    counter = Counter(all_imports)
    top_100 = counter.most_common(100)

    # Print the top 100 imports
    for i, (import_name, count) in enumerate(top_100, start=1):
        print(f"{i}. {import_name} - {count}")

if __name__ == "__main__":
    # Example usage
    list_top_100_imports_no_dll_prefix("legit.csv")
